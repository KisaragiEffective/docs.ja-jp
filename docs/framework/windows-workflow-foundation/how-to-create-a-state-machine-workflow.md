---
title: '方法: ステート マシン ワークフローを作成する'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 3ec60e8f-fad4-493e-a426-e7962d7aee8c
ms.openlocfilehash: e93f84f0bacf7ac205294c12c55afcab8d7319b7
ms.sourcegitcommit: 005980b14629dfc193ff6cdc040800bc75e0a5a5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/14/2019
ms.locfileid: "70989811"
---
# <a name="how-to-create-a-state-machine-workflow"></a>方法: ステート マシン ワークフローを作成する
ワークフローは、ビルトイン アクティビティおよびカスタム アクティビティから構築できます。 このトピックでは、<xref:System.Activities.Statements.StateMachine> アクティビティなどの組み込みアクティビティと、前の [のカスタムアクティビティの両方を使用するワークフローを作成する手順について説明します。アクティビティ](how-to-create-an-activity.md) トピックを作成します。 このワークフローは、数値推測ゲームをモデル化しています。  
  
> [!NOTE]
> チュートリアル入門の各トピックは、前のトピックに応じて異なります。 このトピックを完了するには、最初に次の手順を完了する必要があり [。アクティビティ](how-to-create-an-activity.md)を作成します。  
  
> [!NOTE]
> チュートリアルの完成版をダウンロードするには、「 [Windows Workflow Foundation (WF45) - Getting Started Tutorial (Windows Workflow Foundation (WF45) - チュートリアル入門)](https://go.microsoft.com/fwlink/?LinkID=248976)」を参照してください。  
  
### <a name="to-create-the-workflow"></a>ワークフローを作成するには  
  
1. **ソリューションエクスプローラー**で **[NumberGuessWorkflowActivities]** を右クリックし、 **[追加]** 、 **[新しい項目]** の順に選択します。  
  
2. **[インストール済み]** の **[共通項目]** ノードで、 **[ワークフロー]** を選択します。 **[ワークフロー]** の一覧から **[アクティビティ]** を選択します。  
  
3. **[名前]** ボックスに「`StateMachineNumberGuessWorkflow`」と入力し、 **[追加]** をクリックします。  
  
4. **ツールボックス**の **[ステートマシン]** セクションから**StateMachine**アクティビティをドラッグし、ワークフローデザインサーフェイスの **[ここにアクティビティをドロップ]** ラベルにドロップします。  
  
### <a name="to-create-the-workflow-variables-and-arguments"></a>ワークフロー変数および引数を作成するには  
  
1. **ソリューションエクスプローラー**で**statemachinenumberguessworkflow.xaml**をダブルクリックして、ワークフローをデザイナーに表示します (まだ表示されていない場合)。  
  
2. ワークフローデザイナーの左下にある **[引数]** をクリックして、 **[引数]** ペインを表示します。  
  
3. **[引数の作成]** をクリックします。  
  
4. **[名前]** ボックスに「`MaxNumber`」と入力し、 **[方向]** ドロップダウンリストから **[In]** を選択します。次に、 **[引数の型]** ドロップダウンリストから **[Int32]** を選択し、enter キーを押して引数を保存します。  
  
5. **[引数の作成]** をクリックします。  
  
6. 新しく追加した `MaxNumber` 引数の下にある **[名前]** ボックスに「`Turns`」と入力し、 **[方向]** ドロップダウンリストから **[Out]** を選択します。次に、 **[引数の型]** ドロップダウンリストから **[Int32]** を選択し、enter キーを押します。  
  
7. アクティビティデザイナーの左下にある **[引数]** をクリックして、 **[引数]** ペインを閉じます。  
  
8. ワークフローデザイナーの左下にある **[変数]** をクリックして、 **[変数]** ペインを表示します。  
  
9. **[変数の作成]** をクリックします。  
  
    > [!TIP]
    > **[変数の作成]** ボックスが表示されない場合は、ワークフローデザイナー画面の [<xref:System.Activities.Statements.StateMachine>] アクティビティをクリックして選択します。  
  
10. **[名前]** ボックスに「`Guess`」と入力し、 **[変数の型]** ドロップダウンリストから **[Int32]** を選択します。次に、enter キーを押して変数を保存します。  
  
11. **[変数の作成]** をクリックします。  
  
12. **[名前]** ボックスに「`Target`」と入力し、 **[変数の型]** ドロップダウンリストから **[Int32]** を選択します。次に、enter キーを押して変数を保存します。  
  
13. アクティビティデザイナーの左下にある **[変数]** をクリックして、 **[変数]** ペインを閉じます。  
  
### <a name="to-add-the-workflow-activities"></a>ワークフロー アクティビティを追加するには  
  
1. **[State1]** をクリックして選択します。 [**プロパティ] ウィンドウ**で、 **DisplayName**を `Initialize Target`に変更します。  
  
    > [!TIP]
    > [**プロパティ] ウィンドウ**が表示されていない場合は、 **[表示]** メニューの **[プロパティウィンドウ]** をクリックします。  
  
2. ワークフローデザイナーで、新しく名前を変更した **[初期化のターゲット]** 状態をダブルクリックして展開します。  
  
3. **ツールボックス**の **[プリミティブ]** セクションから**Assign**アクティビティをドラッグし、状態の**Entry**セクションにドロップします。 **[To]** ボックスに「`Target`」と入力し、 **[式C#の入力]** または **[VB の式を入力]** してください ボックスに次の式を入力します。  
  
    ```vb  
    New System.Random().Next(1, MaxNumber + 1)  
    ```  
  
    ```csharp  
    new System.Random().Next(1, MaxNumber + 1)  
    ```  
  
    > [!TIP]
    > **[ツールボックス]** ウィンドウが表示されていない場合は、 **[表示]** メニューの **[ツールボックス]** を選択します。  
  
4. ワークフローデザイナーの上部にある階層リンク表示で **[StateMachine]** をクリックして、ワークフローデザイナーの全体的なステートマシンビューに戻ります。  
  
5. **ツールボックス**の **[ステートマシン]** セクションから**state**アクティビティをワークフローデザイナーにドラッグし、 **[Initialize Target]** 状態の上に置きます。 新しい状態がその上にあると、4つの三角形が**Initialize ターゲット**状態の周囲に表示されることに注意してください。 **Initialize ターゲット**状態のすぐ下にある三角形に新しい状態をドロップします。 これにより、新しい状態がワークフローに配置され、 **Initialize ターゲット**状態から新しい状態への遷移が作成されます。  
  
6. **[State1]** をクリックして選択し、 **DisplayName**を `Enter Guess`に変更します。次に、ワークフローデザイナーで状態をダブルクリックして展開します。  
  
7. **ツールボックス**の **[プリミティブ]** セクションから**WriteLine**アクティビティをドラッグし、状態の**Entry**セクションにドロップします。  
  
8. **WriteLine**の **[Text]** プロパティボックスに次の式を入力します。  
  
    ```vb  
    "Please enter a number between 1 and " & MaxNumber  
    ```  
  
    ```csharp  
    "Please enter a number between 1 and " + MaxNumber  
    ```  
  
9. **[ツールボックス]** の **[プリミティブ]** セクションから**Assign**アクティビティをドラッグし、状態の **[終了]** セクションにドロップします。  
  
10. **[To]** ボックスに「`Turns`」と入力し、 **[式のC#入力]** ボックスまたは **[VB の式を入力]** してください ボックスに `Turns + 1` します。  
  
11. ワークフローデザイナーの上部にある階層リンク表示で **[StateMachine]** をクリックして、ワークフローデザイナーの全体的なステートマシンビューに戻ります。  
  
12. **ツールボックス**の **[ステートマシン]** セクションから**finalstate**アクティビティをドラッグし、 **enter guess**状態の上にマウスポインターを移動して **、enter guess 状態の**右側に表示される三角形にドロップします。これにより、 **enter guess**と**finalstate**の間に遷移が作成されます。  
  
13. 遷移の既定の名前は**T2**です。 ワークフローデザイナーで遷移をクリックして選択し、その**DisplayName**を **[正しい推測]** に設定します。 次に、 **[Finalstate]** をクリックして選択し、右側にドラッグして、2つの状態のいずれかをオーバーレイせずに完全な遷移名を表示できるようにします。 これにより、チュートリアルの残りの手順をより簡単に実行できます。  
  
14. ワークフローデザイナーで、新しく名前を変更した **[推測]** をダブルクリックして展開します。  
  
15. **[ツールボックス]** の **[NumberGuessWorkflowActivities]** セクションから**readint**アクティビティをドラッグし、遷移の **[トリガー]** セクションにドロップします。  
  
16. **Readint**アクティビティの [**プロパティ] ウィンドウ**で、 **[BookmarkName]** プロパティ値ボックスに引用符を含め `"EnterGuess"` を入力し、 **[Result]** プロパティ値ボックスに「`Guess`」と入力します。  
  
17. [**正しい**移行の**条件**] プロパティ値ボックスに次の式を入力します。  
  
    ```vb  
    Guess = Target  
    ```  
  
    ```csharp  
    Guess == Target  
    ```  
  
18. ワークフローデザイナーの上部にある階層リンク表示で **[StateMachine]** をクリックして、ワークフローデザイナーの全体的なステートマシンビューに戻ります。  
  
    > [!NOTE]
    > トリガー イベントが受け取られ、<xref:System.Activities.Statements.Transition.Condition%2A> (存在する場合) が `True` と評価される場合に遷移が発生します。 この遷移では、ユーザーの `Guess` がランダムに生成された `Target`と一致する場合、制御が**Finalstate**に渡され、ワークフローが完了します。  
  
19. 推定値が正しいかどうかに応じて、ワークフローは、 **Finalstate**に遷移するか、別の try に対し**て Enter guess**状態に戻す必要があります。 両方の遷移は、 **Readint**アクティビティを使用してユーザーの推定値を受け取ることを待機しているのと同じトリガーを共有します。 これは、共有遷移と呼ばれます。 共有遷移を作成するには、**推測の正しい**切り替え効果の開始を示す円をクリックし、目的の状態にドラッグします。 この場合、切り替え効果は自己遷移型であるため、**推測**の開始点をドラッグして、 **Enter Guess**状態の下にドロップします。 遷移を作成した後、ワークフローデザイナーでそれを選択し、その**DisplayName**プロパティを「**正しくない推測**」に設定します。  
  
    > [!NOTE]
    > 切り替え効果は、切り替え効果デザイナーの下部にある **[共有トリガー遷移の追加]** をクリックして、 **[接続可能な状態]** ボックスから目的のターゲット状態を選択することによっても作成できます。  
  
    > [!NOTE]
    > 遷移の <xref:System.Activities.Statements.Transition.Condition%2A> が `false` と評価された場合 (またはトリガーを共有する遷移すべての状態が `false` と評価された場合)、遷移は行われず、その状態からのすべての遷移のすべてのトリガーが再スケジュールされます。 このチュートリアルでは、条件の構成方法 (推定値が正しいか間違っているかを判断する特定のアクションが用意されています) により、この状況は発生しません。  
  
20. ワークフローデザイナーで [**推測**されない] をダブルクリックして展開します。 **トリガー**は、**推定の正しい**切り替えによって使用されたのと同じ**readint**アクティビティに既に設定されていることに注意してください。  
  
21. **[条件]** プロパティ値ボックスに次の式を入力します。  
  
    ```vb  
    Guess <> Target  
    ```  
  
    ```csharp  
    Guess != Target  
    ```  
  
22. **[ツールボックス]** の **[制御フロー]** セクションから**If**アクティビティをドラッグし、遷移の **[アクション]** セクションにドロップします。  
  
23. **If**アクティビティの **[Condition]** プロパティ値ボックスに次の式を入力します。  
  
    ```text
    Guess < Target
    ```  
  
24. **ツールボックス**の **[プリミティブ]** セクションから2つの**WriteLine**アクティビティをドラッグし、 **if**アクティビティの**Then**セクション、1が**Else**セクションにあるようにドロップします。  
  
25. **[Then** ] セクションで **[WriteLine]** アクティビティをクリックして選択し、 **[Text]** プロパティ値ボックスに次の式を入力します。  
  
    ```text
    "Your guess is too low."  
    ```  
  
26. **[Else]** セクションの**WriteLine**アクティビティをクリックして選択し、 **[Text]** プロパティ値ボックスに次の式を入力します。  
  
    ```text
    "Your guess is too high."  
    ```  
  
27. ワークフローデザイナーの上部にある階層リンク表示で **[StateMachine]** をクリックして、ワークフローデザイナーの全体的なステートマシンビューに戻ります。  
  
     次の例は完成したワークフローを示しています。  
  
     ![完成したステートマシンのワークフローを示す図。](./media/how-to-create-a-state-machine-workflow/complete-state-machine-workflow.jpg)  
  
### <a name="to-build-the-workflow"></a>ワークフローをビルドするには  
  
1. Ctrl キーと Shift キーを押しながら B キーを押して、ソリューションをビルドします。  
  
     ワークフローを実行する方法については、次のトピック「[方法」を参照してください。ワークフロー](how-to-run-a-workflow.md)を実行します。 [を既に完了している場合は、次の方法を実行します。異なるスタイルのワークフローを使用してワークフロー](how-to-run-a-workflow.md) ステップを実行し、この手順のステートマシンワークフローを使用して実行するには、の「[アプリケーションをビルドして実行するに](how-to-run-a-workflow.md#BKMK_ToRunTheApplication)[は」に進んでください: ワークフローを実行します](how-to-run-a-workflow.md)。  
  
## <a name="see-also"></a>関連項目

- <xref:System.Activities.Statements.Flowchart>
- <xref:System.Activities.Statements.FlowDecision>
- [Windows Workflow Foundation プログラミング](programming.md)
- [ワークフローの設計](designing-workflows.md)
- [チュートリアル入門](getting-started-tutorial.md)
- [方法: アクティビティ を作成する](how-to-create-an-activity.md)
- [方法: ワークフロー を実行する](how-to-run-a-workflow.md)
