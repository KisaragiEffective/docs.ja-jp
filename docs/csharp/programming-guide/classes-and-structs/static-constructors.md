---
title: 静的コンストラクター - C# プログラミング ガイド
description: C# の静的コンストラクターは、静的データを初期化するか、または 1 回だけ実行されるアクションを実行します。 それは、最初のインスタンスが作成される前、または静的メンバーが参照される前に実行されます。
ms.date: 03/30/2021
helpviewer_keywords:
- static constructors [C#]
- constructors [C#], static
ms.openlocfilehash: f7ab97c3723c04b9d442daabb85f8d16967eb0e4
ms.sourcegitcommit: b5d2290673e1c91260c9205202dd8b95fbab1a0b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/01/2021
ms.locfileid: "106123003"
---
# <a name="static-constructors-c-programming-guide"></a>静的コンストラクター (C# プログラミング ガイド)

静的コンストラクターは、任意の[静的](../../language-reference/keywords/static.md)データを初期化するため、または 1 回だけ実行する必要がある特定のアクションを実行するために使用されます。 最初のインスタンスが作成され前、または静的メンバーが参照される前に、自動的に呼び出されます。  
  
 [!code-csharp[SimpleClass#1](snippets/static-constructors/Program.cs#1)]

## <a name="remarks"></a>Remarks

静的コンストラクターには、次の特徴があります。  
  
- 静的コンストラクターにはアクセス修飾子が指定されず、パラメーターもありません。  

- クラスまたは構造体は、静的コンストラクターを 1 つだけ持つことができます。

- 静的コンストラクターを継承またはオーバーロードすることはできません。

- 静的コンストラクターは、直接呼び出すことはできず、共通言語ランタイム (CLR) によって呼び出されることだけが意図されています。 自動的に呼び出されます。

- ユーザーは、プログラムで静的コンストラクターが実行されるタイミングを制御できません。
  
- 静的コンストラクターは自動的に呼び出されます。 最初のインスタンスが作成され前、または任意の静的メンバーが参照される前に、それによって[クラス](../../language-reference/keywords/class.md)の初期化が行われます。 静的コンストラクターは、インスタンス コンストラクターの前に実行されます。 イベントまたはデリゲートに割り当てられている静的メソッドが呼び出されるときは型の静的コンストラクターが呼び出されますが、割り当てられるときは呼び出されません。 静的フィールド変数初期化子が静的コンストラクターのクラスに存在する場合、それらは、クラス宣言に出現するテキストの順序で実行されます。 初期化子は、静的コンストラクターの実行直前に実行されます。

- 静的フィールドを初期化するための静的コンストラクターを指定しないと、すべての静的フィールドは、「[C# 型の既定値](../../language-reference/builtin-types/default-values.md)」で示されている既定値に初期化されます。
  
- 静的コンストラクターから例外がスローされた場合、ランタイムでそれが再度呼び出されることはなく、その型は、アプリケーション ドメインの有効期間中、初期化されないままになります。 ほとんどの場合、静的コンストラクターで型をインスタンス化できないとき、または静的コンストラクター内でハンドルされない例外が発生したときは、<xref:System.TypeInitializationException> 例外がスローされます。 ソース コードで明示的に定義されていない静的コンストラクターでは、トラブルシューティングを行うときに中間言語 (IL) のコードを調べることが必要になる場合があります。

- 静的コンストラクターが存在すると、<xref:System.Reflection.TypeAttributes.BeforeFieldInit> 型属性を追加できません。 これにより、ランタイムの最適化が制限されます。

- `static readonly` として宣言されているフィールドは、その宣言の一部として、または静的コンストラクター内でのみ、割り当てることができます。 明示的な静的コンストラクターが必要ない場合は、ランタイムのより適切な最適化のため、静的コンストラクターではなく、宣言時に静的フィールドを初期化します。

- 静的コンストラクターは、ランタイムによって単一のアプリケーション ドメイン内で 1 回だけ呼び出されます。 その呼び出しは、特定の型のクラスに基づいてロックされた領域で行われます。 静的コンストラクターの本体に、追加のロック メカニズムは必要ありません。 デッドロックのリスクを回避するには、静的コンストラクターおよび初期化子内で現在のスレッドをブロックしないでください。 たとえば、タスク、スレッド、待機ハンドル、またはイベントを待機したり、ロックを取得したり、並列操作 (並列ループ、`Parallel.Invoke`、Parallel LINQ クエリなど) のブロックを実行したりしないでください。

> [!Note]
> 直接アクセスすることはできませんが、初期化の例外のトラブルシューティングを助けるため、明示的な静的コンストラクターが存在することを文書化する必要があります。

### <a name="usage"></a>使用方法

- 静的コンストラクターの一般的な用途は、クラスがログ ファイルを使っていて、このファイルにエントリを書き込むためにコンストラクターが使われる場合です。  
- コンストラクターが `LoadLibrary` メソッドを呼び出すことができる場合は、アンマネージ コードのラッパー クラスを作成するときにも静的コンストラクターが役に立ちます。  

- 静的コンストラクターは、型パラメーターの制約によりコンパイル時にチェックできない型パラメーターに対して、実行時にチェックを強制するのに適した場所でもあります。

## <a name="example"></a>例

 この例では、`Bus` クラスに静的コンストラクターがあります。 `Bus` の最初のインスタンスが作成されるとき (`bus1`)、静的コンストラクターが呼び出されてクラスが初期化されます。 サンプルの出力では、`Bus` のインスタンスが 2 つでも静的コンストラクターは 1 回だけ実行されること、およびインスタンス コンストラクターの実行前に静的コンストラクターが実行されることがわかります。  
  
 [!code-csharp[BusSample#2](snippets/static-constructors/Program.cs#2)]

## <a name="c-language-specification"></a>C# 言語仕様

詳しくは、[C# 言語仕様](~/_csharplang/spec/introduction.md)の「[Static constructors (静的コンストラクター)](~/_csharplang/spec/classes.md#static-constructors)」セクションをご覧ください。
  
## <a name="see-also"></a>関連項目

- [C# プログラミング ガイド](../index.md)
- [クラスと構造体](./index.md)
- [コンストラクター](./constructors.md)
- [静的クラスと静的クラス メンバー](./static-classes-and-static-class-members.md)
- [ファイナライザー](./destructors.md)
- [コンストラクターのデザインのガイドライン](../../../standard/design-guidelines/constructor.md#type-constructor-guidelines)
- [セキュリティの警告 - CA2121: 静的コンストラクターはプライベートでなければなりません](/visualstudio/code-quality/ca2121-static-constructors-should-be-private)
