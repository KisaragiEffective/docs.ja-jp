---
title: ストリーミング サービスと繰り返しフィールド - WCF 開発者向け gRPC
description: gRPC を使用してデータのコレクションを渡す方法として、繰り返しフィールドとストリーミング サービスを比較します。
ms.date: 09/02/2019
ms.openlocfilehash: 542ebc393f9c9c1ad717d02d01fab33d85c18917
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/12/2020
ms.locfileid: "79147751"
---
# <a name="grpc-streaming-services-vs-repeated-fields"></a>gRPC ストリーミング サービスと繰り返しフィールド

gRPC のサービスには、データセット (オブジェクトのリスト) を返すための 2 つの方法が用意されています。 プロトコル バッファー メッセージの仕様では、別のメッセージ内にメッセージのリストまたは配列を宣言するために、`repeated` キーワードを使用します。 gRPC サービスの仕様では、長時間実行される永続的な接続を宣言するために、`stream` キーワードを使用します。 その接続では、複数のメッセージが送信され、個別に処理できます。

通知やログ メッセージなど、長時間実行される一時的なデータには、`stream` 機能を使用することもできます。 ただし、この章では、それは 1 つのデータセットを返すために使用するものと想定します。

次のような要因に応じて、それを使用する必要があります。

- データセットの全体的なサイズ。
- クライアント側またはサーバー側でデータセットを作成するために要した時間。
- データセットのコンシューマーは、最初のアイテムが使用可能になるとすぐにアクションを開始できるか、または役に立つ処理を行うには完全なデータセットが必要か。

## <a name="when-to-use-repeated-fields"></a>どのようなときに `repeated` フィールドを使用するか

サイズが制限され、短時間 (1 秒未満など) で完全に生成できるデータセットの場合 は、通常の Protobuf メッセージで `repeated` フィールドを使用する必要があります。 たとえば、eコマース システムでは、注文内の項目のリストを作成するのはおそらく簡単であり、リストが非常に大きくなることはありません。 `repeated` フィールドを含む 1 つのメッセージを返すと、`stream` を使用する場合よりはるかに高速になり、ネットワークのオーバーヘッドが減少します。

クライアントで処理を開始する前にすべてのデータが必要であり、データセットがメモリ内で構築するのに十分な小ささである場合は、`repeated` フィールドの使用を検討します。 サーバー上のメモリ内でデータセットを作成する速度が遅い場合であっても、それを考慮してください。

## <a name="when-to-use-stream-methods"></a>どのようなときに `stream` メソッドを使用するか

データセット内のメッセージ オブジェクトが非常に大きい可能性がある場合は、ストリーミング要求または応答を使用して転送するのが最善です。 メモリ内で大きなオブジェクトを構築し、それをネットワークに書き込んでから、リソースを解放する方が効率的です。 このアプローチを使用すると、サービスのスケーラビリティが向上します。

同様に、作成している間にメモリが不足するのを防ぐため、無制限のサイズのデータセットはストリームで送信する必要があります。

コンシューマーが各項目を個別に処理できるデータセットの場合、進行状況をユーザーに示すことができる場合は、ストリームの使用を検討する必要があります。 ストリームを使用すると、アプリケーションの応答性を向上させることができますが、アプリケーションの全体的なパフォーマンスとのバランスを考える必要があります。

ストリームが役に立つ可能性があるもう 1 つのシナリオは、メッセージが複数のサービスで処理される場合です。 チェーン内の各サービスによって 1 つのストリームが返される場合、ターミナル サービス (つまり、チェーン内の最後のもの) でメッセージの返送を開始できます。 これらのメッセージは、元の要求元まで、チェーンに沿って処理して戻すことができます。 要求元では、ストリームを返すか、結果を 1 つの応答メッセージに集約することができます。 このアプローチは、MapReduce のようなパターンに適しています。

>[!div class="step-by-step"]
>[前へ](migrate-duplex-services.md)
>[次へ](client-libraries.md)
