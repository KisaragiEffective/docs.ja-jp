---
title: 移行するプロジェクトの順序を確認する
description: 通常、大規模なアプリは、一度に新しいプラットフォームに移行されることはありませんが、一連の小さな手順で実行されます。 ASP.NET MVC アプリを ASP.NET Core に移行するための手順を計画する方法について説明します。
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: 452898da5839f8979a5e4f9ebf5d4c21b250e1fa
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/04/2021
ms.locfileid: "102401379"
---
# <a name="identify-sequence-of-projects-to-migrate"></a>移行するプロジェクトの順序を確認する

複数のフロントエンドアプリに関連するソリューションの場合は、アプリを1つずつ移行することをお勧めします。 たとえば、1つのフロントエンドアプリとその依存関係のみを含むソリューションを作成し、関連する作業の範囲を簡単に識別できるようにします。 ソリューションは軽量であり、必要に応じて複数のソリューションにプロジェクトを含めることができます。 移行時には、ソリューションを組織のツールとして活用できます。

移行する ASP.NET アプリを特定し、それに依存するプロジェクトがあることを確認したら (理想的にはソリューションで)、次の手順として、フレームワークと NuGet の依存関係を識別します。 すべての依存関係を特定することで、最も簡単な移行方法は "ボトムアップ" アプローチです。 この方法では、最も低いレベルの依存関係が最初に移行されます。 次のレベルの依存関係は、最終的にはフロントエンドアプリだけに移行されます。 図3-1 は、アプリを作成するプロジェクトのセットの例を示しています。 下位レベルのクラスライブラリは一番下にあり、ASP.NET MVC プロジェクトは一番上にあります。

![プロジェクト依存関係](./media/Figure3-1.png)

**図 3-1.** プロジェクトの依存関係グラフ。

特定のフロントエンドアプリ、ASP.NET MVC 5/Web API 2 プロジェクトを選択します。 ソリューション内の依存関係を特定し、完全な一覧が表示されるまで依存関係をマッピングします。 図3-1 に示すような図は、プロジェクトの依存関係をマップするときに役立つ場合があります。 Visual Studio では、使用しているエディションに応じて、 [ソリューションの依存関係図](/visualstudio/modeling/create-layer-diagrams-from-your-code)を生成できます。 [.Net 移植性アナライザーは、](../../standard/analyzers/portability-analyzer.md) 依存関係図を生成することもできます。

図3-2 は、 [.Net 移植性アナライザーの Visual Studio 拡張機能](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer)のインストーラーを示しています。

![.NET 移植性アナライザー拡張機能のインストール](./media/Figure3-2.png)

**図 3-2.** .NET 移植性アナライザーのインストーラー。

拡張機能は、Visual Studio 2017 以降をサポートしています。 インストールが完了したら、   >  図3-3 に示すように、[**移植性アナライザーの設定** の分析] メニューから構成します。

![.NET 移植性アナライザー拡張機能を構成する](./media/Figure3-3.png)

**図 3-3.** .NET 移植性アナライザーを構成します。

アナライザーによって、各アセンブリの詳細なレポートが生成されます。 レポート:

* 各プロジェクトが特定のターゲットフレームワーク (.NET Core 3.1 や .NET Standard 2.0 など) とどのように互換性があるかについて説明します。
* 特定のプロジェクトを特定のターゲットフレームワークに移植するために必要な作業をチームが評価するのに役立ちます。

この分析の詳細については、次のセクションで説明します。

プロジェクトとそれらの関係を相互にマップしたら、プロジェクトを移行する順序を決めることができます。 依存関係のないプロジェクトを開始します。 次に、これらのプロジェクトに依存するプロジェクトのツリーを操作します。

図3-1 に示されている例では、他のプロジェクトに依存していないため、 *Contoso. ユーティリティ* プロジェクトから開始します。 次に、 *Contoso. データ* は "ユーティリティ" にのみ依存しています。 次に、"BusinessLogic" ライブラリを移行し、最後にフロントエンドの ASP.NET "Web" プロジェクトを移行します。 この "ボトムアップ" アプローチは、すべてのプロジェクトが移行された後に1つの単位として移行できる、比較的小規模で十分に考慮されていないアプリに適しています。 より複雑な大規模なアプリや、移行に時間がかかるコードが多いほど、より多くの増分戦略を検討する必要があります。

## <a name="unit-tests"></a>単体テスト

前の図には、単体テストプロジェクトがありません。 おそらく、移植されているライブラリの既存の動作を少なくともいくつかカバーするテストがあります。

単体テストを使用している場合は、最初にこれらのプロジェクトを変換することをお勧めします。 作業中のプロジェクトで変更のテストを続行します。 .NET Core への移植は、コードベースに大きな変更があることに注意してください。

MSTest、xUnit、NUnit はすべて .NET Core で動作します。 現在アプリのテストがない場合は、システムの現在の動作を検証するいくつかの特徴テストを構築することを検討してください。 その利点は、移行が完了したら、アプリの動作が変更されていないことを確認できることです。

## <a name="considerations-for-migrating-many-apps"></a>多数のアプリの移行に関する考慮事項

組織によっては、移行するアプリが多数あり、それぞれを手動で移行すると、大量のリソースを使用する必要がある場合があります。 このような状況では、何らかのレベルの自動化が推奨されます。 この章の手順を自動化することができます。 プロジェクトファイルの相違点や共通パッケージの更新などの構造的な変更は、スクリプトで適用できます。 これらのスクリプトは、より多くのプロジェクトで繰り返し実行されるため、洗練されています。 各実行時に、各プロジェクトに必要な手動の手順をすべて確認します。 可能であれば、これらの手動の手順を自動化します。 このアプローチを使用すると、時間の経過と共にアプリの移植をより迅速かつ効率的に実行できるようになり、自動化のサポートが改善されます。

この [Dotnetconf プレゼンテーションで、Lizzy Gallagher Of Mastercard を](https://www.youtube.com/watch?v=C-2haqb60No)使用してこの方法を採用する方法の概要をご覧ください。 このプレゼンテーションで採用されている5つのフェーズは次のとおりです。

- サードパーティの NuGet 依存関係を移行する
- 新しい *.csproj* ファイル形式を使用するようにアプリを移行する
- アプリを ASP.NET Core に移行する (.NET Framework をターゲットにする)
- 内部の NuGet 依存関係を .NET Standard に更新します
- .NET Core 3.1 を対象とするようにすべてのアプリを更新する

アプリの大規模なスイートを自動化する場合、一貫したコーディングのガイドラインとプロジェクトの編成に従うと、大幅に役立ちます。 Automation の取り組みは、この一貫性を効果的にするために依存します。 プロジェクトファイルの解析と移行に加えて、一般的なコードパターンを自動的に移行することもできます。 一部のコードパターンの例には、コントローラーアクションの宣言方法や結果の取得方法の違いが含まれています。

たとえば、移行スクリプトでは、 *Controller.cs* に一致するファイルを検索して、次のいずれかのパターンに一致するコード行を検索できます。

```csharp
   return new HttpStatusCodeResult(200);
   // or
   return new HttpStatusCodeResult(HttpStatusCode.OK);
```

ASP.NET Core では、上記のコード行のいずれかを次のように置き換えることができます。

```csharp
    return Ok();
```

## <a name="summary"></a>まとめ

大規模な .NET Framework アプリを .NET Core に移植するには、次の方法をお勧めします。

1. プロジェクトの依存関係を特定します。
1. 各プロジェクトの移植に必要なものを分析します。
1. 下から開始します。

.NET 移植性アナライザーを使用して、ターゲットプラットフォームと互換性のある既存のライブラリを確認できます。 自動テストを使用すると、アプリが移植される際に重大な変更が発生しないようにすることができます。 これらのテストプロジェクトは、移植された最初のプロジェクトの中にある必要があります。

## <a name="references"></a>関連項目

- [.NET Framework から .NET Core への移植](../../core/porting/index.md)
- [.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md)
- [Channel 9: .NET 移植性アナライザーの概要 (ビデオ)](https://channel9.msdn.com/Blogs/Seth-Juarez/A-Brief-Look-at-the-NET-Portability-Analyzer)
- [2年間、200アプリ: 大規模な .NET Core の移行 (ビデオ)](https://www.youtube.com/watch?v=C-2haqb60No)

>[!div class="step-by-step"]
>[前へ](migrate-large-solutions.md)
>[次へ](understand-update-dependencies.md)
