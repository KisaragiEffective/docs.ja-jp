---
title: 最新デスクトップ アプリケーションのデプロイ
description: モダン デスクトップ アプリケーションのデプロイについて理解しておく必要があるすべての情報。
ms.date: 05/12/2020
ms.openlocfilehash: ba47f09b27adf270734bbfff285fe44dd4175d29
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/30/2021
ms.locfileid: "98615855"
---
# <a name="deploying-modern-desktop-applications"></a>最新デスクトップ アプリケーションのデプロイ

デスクトップ アプリケーションを開発する際に考慮すべき 1 つの点は、アプリケーションをパッケージ化してユーザーのコンピューターにデプロイする方法です。 パッケージ化、デプロイ、およびインストールに関する問題は、それらは通常、開発者とは関心の対象が異なる IT プロフェッショナルが担当するということです。

今日では、開発者と IT プロフェッショナルが緊密に連携してアプリケーションを運用環境に移行するという DevOps の概念を私たち全員が理解しています。 しかし、10 年以上にわたってデスクトップに取り組んできた場合は、次のようなストーリーを目にしたことがあるかもしれません。 開発者チームは、プロジェクトの期限に合わせて懸命に共同作業を行っています。 企業の運営には、多くのユーザーのコンピューターでシステムが動作する必要があるため、経営者たちは心配しています。 "引き渡し" の日、プロジェクト マネージャーはすべての開発者に、コードが正常に動作していて、すべてうまく行っており、出荷できることを確認します。 そこで、パッケージ チームがアプリのセットアップを生成してすべてのユーザーのコンピューターに配布し、一連のテスト ユーザーがアプリケーションを実行します。 しかし、実行しようとしても、UI が表示される前に、アプリケーションから "~ メソッドの ~ オブジェクトが失敗しました" という例外がスローされます。 パニックが広がり始め、簡単な調査によって、サード パーティ製のコントロールを導入した疲れた若い開発者が指し示されます。それは、たしかに "開発用コンピューターでは動作していました"。

従来、デスクトップ アプリケーションのインストールは、主に次の 2 つの理由で非常に厄介でした。

- 開発チームと IT チームの間に緊密な共同作業の文化がない。
- パッケージ化とデプロイの基盤にできる堅牢なテクノロジがない。

実際、次の理由により、アプリをインストールしたことに後悔することがあります。

- 最終的に、コンピューターに望ましくない副作用が発生します。
- 以前にインストールされた一部のアプリケーションが動作しなくなります。

また、アプリをアンインストールするだけでは、システムを元の状態に復元できません。 そのため、"DLL 地獄" や "Winrot" などの造語で呼ぶ、このような状況を経験することが常でした。

この章では、MSIX について説明します。 MSIX は、Microsoft が提供する最新のテクノロジであり、以前のテクノロジを最大限に活用して、将来のパッケージ化テクノロジの堅牢な基盤を提供しようとしています。

パッケージ化テクノロジは、モダン化に関してどのようなことを行う必要があるでしょうか。 パッケージ化は、企業の IT にとって基盤となるものであり、多くの資金が投資されています。 モダン化は、最新のテクノロジを使用することだけに関連しているのではありません。 ビジネス要件を定義する時点から、企業がクライアントに機能を提供するまでの、市場投入までの時間を短縮することにも関連しています。

## <a name="the-modern-application-lifecycle"></a>モダン アプリケーションのライフサイクル

現在は、開発者がアプリのコードを記述してビルドし、生成された資産を IT プロフェッショナルに渡します。 次に、IT プロフェッショナルがアプリを再構成し、再パッケージ化します。通常は MSI、さらに最近では App-V パッケージ形式が使用されます。 その後、アプリは、さまざまなチャネルやツールを使用してデプロイされます。 このアプローチの主な問題の 1 つは、一般に "パッケージ化のまひ状態" として知られています。 問題は、アプリの更新または OS の更新が発生するたびに、このサイクルが繰り返されることです。

このプロセスは、次の図で示されます。

![モダン IT ライフサイクルを示す図](./media/deploy-modern-applications/modern-it-application-lifecycle.png)

企業では、このパッケージ化サイクルを 3 つの独立したサイクルに分割する方法を必要としています。

- OS の更新
- アプリケーションの更新
- カスタマイズ

![モダン IT の好循環を示す図](./media/deploy-modern-applications/modern-it-virtuous-cycle.png)

上の図は、次のことができることを示しています。

- アプリを再パッケージ化しなくても、基になる OS を更新できます。
- 元の開発者パッケージを再パッケージ化しなくても、IT 部門でのカスタマイズが可能になります。

この根本的な変更により、新しいモダン IT ライフサイクルは次の図のようになります。

![Microsoft ツールを使用したアプリケーション ライフサイクルを示す図](./media/deploy-modern-applications/microsoft-it-tools.png)

開発者がアプリを作成し、MSIX パッケージを生成します。IT プロフェッショナルは、再パッケージ化の必要なしに、これを使用および構成できます。 Microsoft では、MSIX テクノロジと共に、パッケージを再パッケージ化せずに IT 部門でカスタマイズおよび構成できるツールを作成しました。

## <a name="msix-the-next-generation-of-deployment"></a>MSIX: 次世代のデプロイ

MSIX より前は、セットアップ ウィザード、MSI、ClickOnce、App-V、スクリプトなど、いくつかのパッケージ化テクノロジがありました。 これらのテクノロジにはそれぞれ独自の強みがあり、Microsoft では、最適なものを選択して MSIX を構築することにしました。 MSIX は、これらのテクノロジを基盤とし、それぞれを最大限に活用して構築されています。

- App-V =\> コンテナー化
- ClickOnce =\> 自動更新
- MSI =\> 簡単に配布

MSIX は、1 つでこれらすべての機能を備えたインストーラー テクノロジとなります。

![MSIX の構築に影響を与えたさまざまなテクノロジを示す図](./media/deploy-modern-applications/msix.png)

### <a name="benefits-of-msix"></a>MSIX の利点

#### <a name="never-regret-installing-an-app"></a>アプリをインストールして後悔しない

MSIX は、予測可能で信頼性の高い、安全なデプロイを提供します。 パッケージ マニフェストに含まれている宣言型のメソッドにより、アプリケーションに必要なすべての資産を OS で追跡できます。 また、副作用のない真にクリーンなアンインストールも提供します。

#### <a name="disk-space-optimization"></a>ディスク領域の最適化

MSIX は、ユーザーのコンピューターのディスク領域におけるアプリケーションのフットプリントを削減するように最適化されています。 ユーザーのファイル用に単一インスタンス記憶域が作成されます。 つまり、同じ DLL を持つ 2 つの異なるパッケージがある場合、DLL は 2 回インストールされません。 プラットフォームでは、特定のアプリによってインストールされたすべてのファイルがその宣言型の性質によって把握されているため、この問題はプラットフォームで処理されます。 また、異なるバージョンの DLL を並行して動作させることもできます。

リソース パッケージを使用すると、多言語アプリを簡単に作成でき、使用されるアプリのインストールは OS で処理されます。

#### <a name="network-optimization"></a>ネットワーク最適化

MSIX では、バイト ブロック レベルでファイルの相違点が検出され、差分更新と呼ばれる機能が使用可能になります。 これは、更新されたバイト ブロックだけがアプリケーションの更新でダウンロードされることを意味します。

![MSIX で差分更新がどのように管理されるかを示す図](./media/deploy-modern-applications/msix-managing-updates.png)

ストリーミング インストールを使用すると、ユーザーはアプリケーションの他の部分をバックグラウンドでダウンロードしながら、アプリケーションでの作業をすぐに開始できます。 この機能は、ユーザーにとって魅力的なエクスペリエンスを提供します。

オプションのパッケージ機能を使用すると、アプリのデプロイでコンポーネント化を実現できるため、必要に応じてダウンロードできます。

#### <a name="simple-packaging-and-deployment"></a>簡単なパッケージ化とデプロイ

AppManifest は、バージョン管理、デバイスのターゲット設定、および識別を、すべてのアプリケーションに対して標準的な方法で宣言します。 また、資産に署名する方法も用意されており、堅牢なセキュリティ基盤となります。

#### <a name="os-managed"></a>OS による管理

アプリケーションのインストール、更新、および削除のプロセスはすべて OS で処理されます。 アプリケーションはユーザーごとにインストールされますが、ダウンロードされるのは一度だけで、ディスクのフットプリントは最小限に抑えられます。 Microsoft では、Windows 7 でも MSIX エクスペリエンスを提供することに取り組んでいます。

#### <a name="windows-provides-integrity-for-the-app"></a>Windows によってアプリの整合性が提供される

デジタル署名を使用すると、信頼されていないソースからのアプリケーションをインストールしないことを保証できます。 次の理由から、MSIX では改ざんも防止されます。

- ファイル ハッシュの記録を保持します。
- インストール後にファイルが変更されたかどうかを検出します。

#### <a name="works-for-the-entire-app-catalog"></a>アプリ カタログ全体に対して機能する

MSIX の最も優れた点の 1 つは、アプリケーション カタログ全体に対して機能することです。Windows フォーム、WPF、MFC/ATL、Delphi、xCopy によるデプロイ、ClickOnce、またはストアへの移動でも、同じ MSIX パッケージを使用できます。

### <a name="tools"></a>ツール

#### <a name="windows-application-packaging-project"></a>Windows アプリケーション パッケージ プロジェクト

Visual Studio の **Windows アプリケーション パッケージ プロジェクト** というプロジェクトを使用して、デスクトップ アプリのパッケージを生成できます。 その後、そのパッケージを Microsoft Store に発行したり、1 つまたは複数の PC にサイドロードしたりできます。

#### <a name="msix-packaging-tool"></a>MSIX パッケージ作成ツール

MSIX Packaging Tool を使用すると、既存の Win32 アプリケーションを MSIX 形式に再パッケージ化できます。 変換用の対話型 UI とコマンド ラインの両方が用意されており、ソース コードなしでアプリケーションを変換することができます。

![MSIX パッケージ作成ツール](./media/deploy-modern-applications/msix-packaging-tool.png)

#### <a name="package-support-framework"></a>パッケージ サポート フレームワーク

パッケージ サポート フレームワークは、ソース コードにアクセスできない場合に既存の Win32 アプリケーションに修正を適用して MSIX コンテナー内で実行できるようにするのに役立つオープン ソース キットです。 パッケージ サポート フレームワークは、アプリケーションで最新のランタイム環境のベスト プラクティスに従うのに役立ちます。

#### <a name="app-installer"></a>アプリ インストーラー

アプリ インストーラーを使用すると、アプリ パッケージをダブルクリックして Windows 10 アプリをインストールできます。 つまり、ユーザーは、Windows 10 アプリをデプロイするために PowerShell やその他の開発者ツールを使用する必要がありません。 また、アプリ インストーラーでは、Web、オプション パッケージ、関連セットからアプリをインストールすることもできます。

## <a name="how-to-create-an-msix-package-from-an-existing-win32-desktop-application"></a>既存の Win32 デスクトップ アプリケーションから MSIX パッケージを作成する方法

ここでは、既存の Win32 アプリケーションから MSIX パッケージを作成するプロセスについて説明します。 この例では、Windows フォーム アプリを使用します。

まず、ソリューションに新しいプロジェクトを追加し、[Windows アプリケーション パッケージ プロジェクト] を選択して、名前を付けます。

![新しい Windows アプリケーション パッケージ プロジェクトの追加](./media/deploy-modern-applications/add-packaging-project.png)

パッケージ プロジェクトの構造が表示され、"*アプリケーション*" という名前の特別なフォルダーがあります。 このフォルダー内に、パッケージに含めるアプリケーションを指定できます。 複数指定することもできます。

![パッケージ プロジェクトの構造](./media/deploy-modern-applications/packaging-project.png)

"*アプリケーション*" フォルダーを右クリックし、Visual Studio ソリューションからパッケージ化する Windows フォーム プロジェクトを選択します。

![パッケージ プロジェクトへの Windows フォーム プロジェクトの追加](./media/deploy-modern-applications/add-winforms-project.png)

この時点で、パッケージをコンパイルして生成することはできますが、いくつかのことを確認してみましょう。 ユーザー エクスペリエンスを向上させるために、Visual Studio では、モダン アプリケーションでタイルバーとスタート メニューのアイコンとタイル資産を処理するために必要な、すべてのビジュアル資産を自動生成できます。 *Package.appxmanifest* ファイルを開き、マニフェスト デザイナーにアクセスします。 その後、 **[作成]** をクリックするだけで、プロジェクトに存在する特定のイメージからすべてのビジュアル資産を生成できます。

![Visual Studio のマニフェスト デザイナーのスクリーンショット](./media/deploy-modern-applications/manifest-designer.png)

*Package.appxmanifest* ファイルのコードを開くと、いくつかの興味深い項目が表示されます。

`<Package>` のすぐ下に `<Identity>` ノードがあります。 パッケージ化されたアプリケーションにここで ID が与えられ、OS によって管理されます。

![Identity ノード](./media/deploy-modern-applications/identity-node.png)

`<Capabilities>` ノードには、アプリケーションに必要なすべての要件が含まれています。特に `<rescap:Capability Name="runFullTrust" \>` に注目してください。これは、Win32 アプリケーションであるため、アプリを完全信頼モードで実行するように OS に指示しています。

![Capabilities ノード](./media/deploy-modern-applications/capabilities-node.png)

パッケージ プロジェクトをソリューションのスタートアッププロジェクトとして設定し、 *[実行]* を選択します。 これによって次のことが行われます。

- Windows フォーム アプリケーションをコンパイルします。
- ビルド結果から MSIX パッケージを作成します。
- パッケージをデプロイします。
- 開発用コンピューターにローカルにインストールします。
- アプリケーションを起動します。

![インストールされているアプリケーション](./media/deploy-modern-applications/our-installed-application.png)

これにより、MSIX で提供されるクリーンなインストールとアンインストールのエクスペリエンスが、Windows 10 に完全に統合されます。

最後の段階では、MSIX パッケージを別のコンピューターにデプロイする方法について説明します。

パッケージ プロジェクトを右クリックし、 **[ストア]** メニューを選択し、 **[アプリ パッケージの作成]** オプションを選択します。

次に、ストアにアップロードするパッケージを作成するか、サイドローディング用にパッケージを作成するかを選択できます。 ほとんどのモダン化シナリオでは、 **[サイドローディング用のパッケージを作成します]** を選択します。

![パッケージの構成](./media/deploy-modern-applications/configuring-packages.png)

ここでは、同じ MSIX パッケージに必要な数だけ含めることができるため、ターゲットにするさまざまなアーキテクチャを選択できます。

最後の手順では、最終的なインストール資産をデプロイする場所を宣言します。

![更新設定の構成](./media/deploy-modern-applications/configure-update-settings.png)

エンタープライズ ファイル サーバーで共有 UNC パスの Web サーバーを使用することを選択できます。 アプリケーションの更新方法を指定する設定に注意を払ってください。 アプリケーションの更新については、次のセクションで説明します。

詳細な手順ガイドについては、[Visual Studio を使用してソース コードからデスクトップ アプリをパッケージ化する](/windows/msix/desktop/desktop-to-uwp-packaging-dot-net)方法に関するページを参照してください。

## <a name="auto-updates-in-msix"></a>MSIX での自動更新

Windows ストアには Windows Update を使用した優れた更新メカニズムがあります。 ほとんどのエンタープライズ シナリオでは、デスクトップ アプリの配布にストアを使用しません。 したがって、アプリケーションの更新を構成してユーザーにプルするために、類似の方法が必要です。

Windows 10 の機能と MSIX パッケージの組み合わせを使用すると、優れた更新エクスペリエンスをユーザーに提供できます。 実際、ユーザーは技術に熟達している必要はなく、シームレスなアプリケーションの更新エクスペリエンスの恩恵を受けることができます。

次の 2 つの方法でユーザーと対話するように更新を構成できます。

- ユーザーに通知される更新: OS によって自動生成された適切な UI が 表示され、アプリケーションのインストールが実行されようとしていることをユーザーに通知します。 この UI は、インストール ファイルで指定したプロパティに基づいて構築されます。

- バックグラウンドでのサイレント更新。 このオプションを使用すると、ユーザーは更新を意識する必要がありません。

また、アプリケーションの起動時または定期的に実行するように、更新のタイミングを構成することもできます。 サイドローディング機能のおかげで、アプリケーションの実行中にこれらの更新プログラムを取得することもできます。

この種類のデプロイを使用すると、 *.appinstaller* という特殊なファイルが作成されます。 この単純なファイルには、次のセクションがあります。

- *.appinstaller* ファイルの場所
- アプリケーションのメイン MSIX パッケージのプロパティ
- 更新の動作

![.appinstaller ファイル](./media/deploy-modern-applications/appinstaller-file.png)

Microsoft では、このファイルと組み合わせて、リンクからインストール プロセスを起動するための特別な URL プロトコルを設計しました。

```xml
<a href="ms-appinstaller:?source=http://mywebservice.azureedge.net/MyApp.msix">Install app package </a>
```

このプロトコルは、すべてのブラウザーで機能し、Windows 10 の優れたユーザー エクスペリエンスでインストール プロセスを起動します。 OS は、インストール プロセスを管理しているため、このアプリケーションがどの場所からインストールされたかを認識し、プロセスによる影響を受けるすべてのファイルを追跡します。

MSIX は、インストール用のユーザー インターフェイスを自動的に作成して、パッケージの一部のプロパティを表示します。 これにより、すべてのアプリに共通のインストール エクスペリエンスが実現します。

新しい MSIX パッケージを生成してデプロイ サーバーに移動したら、 *.appinstaller* ファイルを編集して、これらの変更を反映する必要があります。主に、新しい MSIX ファイルのバージョンとパスです。 ユーザーがアプリケーションを次回起動したときに、システムによって変更が検出され、新しいバージョンのファイルがバックグラウンドでダウンロードされます。 この処理が完了すると、新しいアプリケーションの起動時にユーザーには透過的にインストールが実行されます。

>[!div class="step-by-step"]
>[[戻る]](example-migration.md)
