---
title: 最新デスクトップ アプリケーションのデプロイ
description: 最新のデスクトップアプリケーションの展開について理解しておく必要があるすべての情報。
ms.date: 05/12/2020
ms.openlocfilehash: ba47f09b27adf270734bbfff285fe44dd4175d29
ms.sourcegitcommit: 632818f4b527e5bf3c48fc04e0c7f3b4bdb8a248
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/20/2021
ms.locfileid: "98615855"
---
# <a name="deploying-modern-desktop-applications"></a>最新デスクトップ アプリケーションのデプロイ

デスクトップアプリケーションを開発する際に考慮すべき1つの点は、アプリケーションをパッケージ化してユーザーのコンピューターに配置する方法です。 パッケージ化、デプロイ、およびインストールに関する問題は、通常、開発者とは異なることに注意して、IT プロフェッショナルの包括的なものになります。

ここでは、開発者や IT 担当者がアプリケーションを運用環境に移行する際に緊密に連携する、DevOps の概念を熟知しています。 しかし、10年以上にわたってデスクトップの戦いを行っている場合は、次のような話をしているかもしれません。 開発者チームは、プロジェクトの期限に合わせて作業を行うことが困難です。 企業では、多くのユーザーのコンピューターで作業する必要があるため、ビジネス担当者は不安ています。 "D 日" では、プロジェクトマネージャーは、コードが正常に動作していることと、すべての問題があることをすべての開発者に確認します。 次に、パッケージチームは、アプリのセットアップを生成し、すべてのユーザーコンピューターに配布し、一連のテストユーザーがアプリケーションを実行します。 UI を表示する前に、アプリケーションが "メソッド ~ オブジェクト ~ 失敗" という例外をスローしています。 パニックからの旅が開始され、簡単な調査では、サードパーティ製のコントロールを導入した若いおよび疲れている開発者を指しています。これは、"開発用コンピューターでの作業" です。

従来、デスクトップアプリケーションのインストールは、主に次の2つの理由で悪夢でした。

- 開発チームと IT チームの間に密接なコラボレーションの文化がない。
- 安定したパッケージ化と展開を可能にするテクノロジの欠如。

実際、次の理由により、アプリをインストールしたことがあります。

- 最終的に、コンピューターに望ましくない副作用が発生します。
- 以前にインストールされた一部のアプリケーションは動作しなくなります。

また、アプリをアンインストールすることで、システムを元の状態に復元することはできません。 私たちは、"DLL の造語" や "Winrot" のような用語を使用して、このような状況に対処しました。

この章では、MSIX について説明します。 MSIX は、Microsoft が提供する最新のテクノロジであり、以前のテクノロジを最大限に活用して、将来のパッケージ化テクノロジの堅牢な基盤を提供しようとしています。

パッケージ化テクノロジは、最新化に関してどのようなことを行う必要がありますか。 このパッケージは、企業の IT 部門にとって多くの資金が投資されています。 最新のテクノロジを使用する場合にのみ、最新化が関連しています。 また、企業がクライアントに機能を提供するまで、ビジネス要件が定義されている時点から市場投入までの時間を短縮することにも関連しています。

## <a name="the-modern-application-lifecycle"></a>最新のアプリケーションライフサイクル

現在、開発者はアプリのコードを記述してビルドし、生成された資産を IT 担当者に渡します。 その後、IT 担当者はアプリを再構成し、通常は MSI または最近の App-v パッケージ形式でパッケージを再パッケージ化します。 このアプリは、さまざまなチャネルやツールを使用してデプロイされます。 このアプローチの主な問題の1つは、一般的に "パッケージング paralysis" と呼ばれています。 問題は、アプリの更新または OS の更新が発生するたびに、このサイクルが繰り返されることです。

このプロセスは、次の図のように表示されます。

![最新の IT ライフサイクルを示す図](./media/deploy-modern-applications/modern-it-application-lifecycle.png)

企業は、このパッケージ化サイクルを3つの独立したサイクルに分割する方法を必要としています。

- OS の更新
- アプリケーションの更新
- カスタマイズ

![最新の IT 好循環サイクルを示す図](./media/deploy-modern-applications/modern-it-virtuous-cycle.png)

前の図は、次のことができることを示しています。

- アプリを再パッケージ化しなくても、基になる OS を更新できます。
- 元の開発者パッケージを再パッケージ化しなくても、カスタマイズを有効にすることができます。

この根の変化により、次の図に示すように、新しい IT ライフサイクルと最新の IT ライフサイクルが得られます。

![Microsoft ツールを使用したアプリケーションライフサイクルを示す図](./media/deploy-modern-applications/microsoft-it-tools.png)

開発者がアプリを作成し、MSIX パッケージを生成します。これは、IT 担当者が再パッケージ化の必要なしに使用および構成できます。 Microsoft では、MSIX テクノロジと共に、パッケージを再パッケージ化せずにカスタマイズおよび構成できるツールを作成しています。

## <a name="msix-the-next-generation-of-deployment"></a>MSIX: 次世代の配置

MSIX より前のバージョンでは、セットアップウィザード、MSI、ClickOnce、App-v、スクリプトなど、いくつかのパッケージテクノロジが用意されていました。 これらの各テクノロジには独自の強みがあり、Microsoft では、MSIX を構築するための最適なものを選択することにしました。 MSIX は、これらのテクノロジを最大限に活用することを基礎として構築されています。

- App-v = \> コンテナー化
- ClickOnce = \> 自動更新
- MSI = \> 簡単に配布

MSIX では、これらすべての機能を備えた1つのインストーラーテクノロジを入手できます。

![MSIX のビルドに影響を与えるさまざまなテクノロジを示す図](./media/deploy-modern-applications/msix.png)

### <a name="benefits-of-msix"></a>MSIX の利点

#### <a name="never-regret-installing-an-app"></a>アプリをインストールしないでください

MSIX は、予測可能で信頼性の高い、安全なデプロイを提供します。 パッケージマニフェストに含まれる宣言型のメソッドを使用すると、アプリケーションに必要なすべての資産を OS で追跡できます。 また、副作用のない真のクリーンアンインストールも提供します。

#### <a name="disk-space-optimization"></a>ディスク領域の最適化

MSIX は、アプリケーションがユーザーのコンピューターディスク領域に与えるフットプリントを削減するように最適化されています。 ファイルの単一インスタンスストレージが作成されます。 つまり、同じ DLL を持つ2つの異なるパッケージがある場合、DLL は2回インストールされません。 プラットフォームは、特定のアプリによってインストールされたすべてのファイルが宣言的な性質を持つことを認識しているため、この問題に対処します。 また、異なるバージョンの DLL を並行して動作させることもできます。

リソースパッケージを使用すると、多言語アプリを簡単に作成できます。 OS は、使用されているアプリのインストールを処理します。

#### <a name="network-optimization"></a>ネットワーク最適化

MSIX は、バイトブロックレベルでファイルの相違点を検出し、差分更新と呼ばれる機能を有効にします。 これは、更新されたバイトブロックだけがアプリケーションの更新プログラムにダウンロードされることを意味します。

![MSIX が差分更新を管理する方法を示す図](./media/deploy-modern-applications/msix-managing-updates.png)

ストリーミングインストールでは、アプリケーションの他の部分がバックグラウンドでダウンロードされている間に、ユーザーがアプリケーションの作業をすぐに開始できます。 この機能は、ユーザーにとって魅力的なエクスペリエンスを提供します。

オプションのパッケージ機能を使用すると、アプリのデプロイでコンポーネント化を獲得できるため、必要に応じてダウンロードできます。

#### <a name="simple-packaging-and-deployment"></a>単純なパッケージ化と配置

Appmanifest.xaml は、バージョン管理、デバイスのターゲット設定、およびすべてのアプリケーションの標準的な方法での識別を宣言します。 また、堅牢なセキュリティ基盤を提供する資産に署名する方法も用意されています。

#### <a name="os-managed"></a>OS で管理

OS は、アプリケーションをインストール、更新、および削除するためのすべてのプロセスを処理します。 アプリケーションはユーザーごとにインストールされますが、ダウンロードされるのは一度だけです。ディスクフットプリントは最小限に抑えられます。 Microsoft は、Windows 7 でも MSIX エクスペリエンスの提供に取り組んでいます。

#### <a name="windows-provides-integrity-for-the-app"></a>Windows はアプリの整合性を提供します

デジタル署名を使用すると、信頼されていないソースからアプリケーションをインストールしないことを保証できます。 MSIX は、次の理由で改ざんを防止します。

- ファイルハッシュの記録を保持します。
- インストール後にファイルが変更されたかどうかを検出します。

#### <a name="works-for-the-entire-app-catalog"></a>アプリカタログ全体に対して機能する

MSIX に関する講演の1つは、アプリケーションカタログ全体、Windows フォーム、WPF、MFC/ATL、Delphi に対して機能することです。これは、xCopy 配置、ClickOnce、またはストアに移動する場合でも、同じ MSIX パッケージを使用できます。

### <a name="tools"></a>ツール

#### <a name="windows-application-packaging-project"></a>Windows アプリケーション パッケージ プロジェクト

Visual Studio の **Windows アプリケーション パッケージ プロジェクト** というプロジェクトを使用して、デスクトップ アプリのパッケージを生成できます。 その後、そのパッケージを Microsoft Store に発行したり、1つまたは複数の Pc にサイドロードすることができます。

#### <a name="msix-packaging-tool"></a>MSIX パッケージ作成ツール

MSIX Packaging Tool を使用すると、既存の Win32 アプリケーションを MSIX 形式に再パッケージ化できます。 対話型の UI と変換用のコマンドラインの両方が用意されており、ソースコードを使用せずにアプリケーションを変換することができます。

![MSIX パッケージ作成ツール](./media/deploy-modern-applications/msix-packaging-tool.png)

#### <a name="package-support-framework"></a>パッケージ サポート フレームワーク

パッケージサポートフレームワークは、ソースコードにアクセスできない場合に、既存の Win32 アプリケーションに修正プログラムを適用するのに役立つオープンソースキットです。これにより、MSIX コンテナーで実行できるようになります。 パッケージ サポート フレームワークは、アプリケーションで最新のランタイム環境のベスト プラクティスに従うのに役立ちます。

#### <a name="app-installer"></a>アプリ インストーラー

アプリのインストーラーを使用すると、アプリパッケージをダブルクリックすることで、Windows 10 アプリをインストールできます。 つまり、ユーザーは、Windows 10 アプリを展開するために PowerShell やその他の開発者ツールを使用する必要がありません。 また、アプリ インストーラーでは、Web、オプション パッケージ、関連セットからアプリをインストールすることもできます。

## <a name="how-to-create-an-msix-package-from-an-existing-win32-desktop-application"></a>既存の Win32 デスクトップアプリケーションから MSIX パッケージを作成する方法

ここでは、既存の Win32 アプリケーションから MSIX パッケージを作成するプロセスについて説明します。 この例では、Windows フォームアプリを使用します。

まず、ソリューションに新しいプロジェクトを追加し、[Windows アプリケーションパッケージ] プロジェクトを選択して、名前を付けます。

![新しい Windows アプリケーションパッケージプロジェクトを追加しています](./media/deploy-modern-applications/add-packaging-project.png)

パッケージプロジェクトの構造が表示され、 *アプリケーション* と呼ばれる特別なフォルダーが記録されます。 このフォルダー内に、パッケージに含めるアプリケーションを指定できます。 複数の値を指定できます。

![パッケージプロジェクトの構造](./media/deploy-modern-applications/packaging-project.png)

[ *アプリケーション* ] フォルダーを右クリックし、Visual Studio ソリューションからパッケージ化する Windows フォームプロジェクトを選択します。

![パッケージプロジェクトへの Windows フォームプロジェクトの追加](./media/deploy-modern-applications/add-winforms-project.png)

この時点で、パッケージをコンパイルして生成することはできますが、いくつかのことを確認してみましょう。 ユーザーエクスペリエンスを向上させるために、Visual Studio では、最新のアプリケーションがタイルバーと [スタート] メニューのアイコンとタイルアセットを処理するために必要なすべてのビジュアルアセットを自動生成できます。 *Package.appxmanifest* ファイルを開き、マニフェストデザイナーにアクセスします。 その後、[ **作成**] をクリックするだけで、プロジェクトに存在する特定のイメージからすべてのビジュアルアセットを生成できます。

![Visual Studio のマニフェストデザイナーのスクリーンショット](./media/deploy-modern-applications/manifest-designer.png)

*Package.appxmanifest* ファイルのコードを開くと、いくつかの興味深い項目が表示されます。

すぐ下 `<Package>` にノードがあり `<Identity>` ます。 これは、パッケージアプリケーションが id を取得する場所であり、OS によって管理されます。

![Id ノード](./media/deploy-modern-applications/identity-node.png)

ノードでは、 `<Capabilities>` アプリケーションが必要とするすべての要件を見つけることができます。に特に注意してください。これは、 `<rescap:Capability Name="runFullTrust" \>` Win32 アプリケーションであるため、アプリを完全信頼モードで実行するように OS に指示します。

![機能ノード](./media/deploy-modern-applications/capabilities-node.png)

パッケージプロジェクトをソリューションのスタートアッププロジェクトとして設定し、[ *実行*] を選択します。 次のようになります。

- Windows フォームアプリケーションをコンパイルします。
- ビルド結果から MSIX パッケージを作成します。
- パッケージを展開します。
- 開発用コンピューターにローカルにインストールします。
- アプリケーションを起動します。

![インストールされているアプリケーション](./media/deploy-modern-applications/our-installed-application.png)

これにより、MSIX が Windows 10 に完全に統合された、クリーンインストールおよびアンインストールエクスペリエンスが提供されます。

最後の段階では、MSIX パッケージを別のコンピューターに展開する方法について説明します。

パッケージプロジェクトを右クリックし、[ **ストア** ] メニューを選択し、[ **アプリパッケージの作成** ] オプションを選択します。

次に、ストアにアップロードするパッケージを作成するか、サイドローディング用にパッケージを作成するかを選択できます。 ほとんどの近代化シナリオでは、 **サイドローディング用のパッケージを作成** することを選択します。

![パッケージの構成](./media/deploy-modern-applications/configuring-packages.png)

ここでは、同じ MSIX パッケージに必要な数だけ含めることができるため、ターゲットにするさまざまなアーキテクチャを選択できます。

最後の手順では、最終的なインストールアセットをデプロイする場所を宣言します。

![更新設定の構成](./media/deploy-modern-applications/configure-update-settings.png)

エンタープライズファイルサーバーで共有 UNC パスの web サーバーを使用することを選択できます。 設定に注意を払って、アプリケーションの更新方法を指定します。 アプリケーションの更新については、次のセクションで説明します。

詳細な手順ガイドについては、「 [Visual Studio を使用してソースコードからデスクトップアプリをパッケージ化する](/windows/msix/desktop/desktop-to-uwp-packaging-dot-net)」を参照してください。

## <a name="auto-updates-in-msix"></a>MSIX での自動更新

Windows ストアには Windows Update を使用した優れた更新メカニズムがあります。 ほとんどのエンタープライズシナリオでは、デスクトップアプリの配布にストアを使用しません。 そのため、アプリケーションの更新プログラムを構成してユーザーにプルするのと同様の方法が必要です。

Windows 10 の機能と MSIX パッケージの組み合わせを使用すると、ユーザーにとって優れた更新エクスペリエンスを提供できます。 実際、ユーザーは技術的には必要ありませんが、シームレスなアプリケーションの更新エクスペリエンスの恩恵を受けることができます。

次の2つの方法で、ユーザーと対話するように更新プログラムを構成できます。

- ユーザーによる更新のプロンプト: OS には、アプリケーションのインストールが実行されようとしていることをユーザーに通知する、自動生成された優れた UI が表示されます。 この UI は、インストールファイルで指定したプロパティに基づいて構築されます。

- バックグラウンドでサイレント更新を行います。 このオプションを使用すると、ユーザーは更新プログラムを意識する必要がありません。

また、アプリケーションの起動時または定期的に更新を実行するタイミングを構成することもできます。 サイドローディング機能のおかげで、アプリケーションの実行中にこれらの更新プログラムを取得することもできます。

この種類の配置を使用すると、appinstaller という特殊なファイルが作成され *ます。* この単純なファイルには、次のセクションが含まれています。

- *Appinstaller* ファイルの場所
- アプリケーションのメインの MSIX パッケージのプロパティ
- 更新プログラムの動作

![appinstaller ファイル](./media/deploy-modern-applications/appinstaller-file.png)

Microsoft では、このファイルと組み合わせて、リンクからインストールプロセスを起動するための特別な URL プロトコルを設計しました。

```xml
<a href="ms-appinstaller:?source=http://mywebservice.azureedge.net/MyApp.msix">Install app package </a>
```

このプロトコルは、すべてのブラウザーで機能し、Windows 10 の優れたユーザーエクスペリエンスでインストールプロセスを起動します。 OS はインストールプロセスを管理するため、このアプリケーションがインストールされた場所を認識し、プロセスによって影響を受けるすべてのファイルを追跡します。

MSIX は、パッケージの一部のプロパティを自動的に表示するインストール用のユーザーインターフェイスを作成します。 これにより、すべてのアプリに共通のインストールエクスペリエンスが実現します。

新しい MSIX パッケージを生成してデプロイサーバーに移動したら、 *appinstaller* ファイルを編集して、これらの変更を反映する必要があります。これは、主に新しい msix ファイルのバージョンとパスです。 次回ユーザーがアプリケーションを起動したときに、システムは変更を検出し、新しいバージョンのファイルをバックグラウンドでダウンロードします。 この処理が完了すると、ユーザーに対して透過的に新しいアプリケーションの起動時にインストールが実行されます。

>[!div class="step-by-step"]
>[[戻る]](example-migration.md)
